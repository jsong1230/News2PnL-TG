# Cursor Rules for News2PnL-TG

## 커밋 푸시 전 필수 검증

커밋 푸시 전에 반드시 다음 검증을 수행해야 합니다:

### 1. Python 문법 및 Import 오류 확인
```bash
# 모든 Python 파일의 문법 오류 확인
python -m py_compile scripts/run_morning.py scripts/run_evening.py scripts/run_monthly.py
python -m py_compile src/**/*.py

# 또는 pytest로 기본 검증
python -m pytest tests/ -q --tb=short
```

### 2. 주요 스크립트 Import 검증
다음 명령어들이 오류 없이 실행되어야 합니다:
```bash
# 각 스크립트의 import 체크 (실제 실행은 하지 않고 import만 확인)
python -c "import sys; sys.path.insert(0, '.'); from scripts.run_morning import main; print('✓ run_morning.py import OK')"
python -c "import sys; sys.path.insert(0, '.'); from scripts.run_evening import main; print('✓ run_evening.py import OK')"
python -c "import sys; sys.path.insert(0, '.'); from scripts.run_monthly import main; print('✓ run_monthly.py import OK')"
```

### 3. 핵심 모듈 Import 검증
```bash
# 핵심 모듈들이 정상적으로 import되는지 확인
python -c "
import sys
sys.path.insert(0, '.')
try:
    from src.config import validate_config
    from src.reports.morning import generate_morning_report
    from src.reports.evening import generate_evening_report
    from src.reports.monthly import generate_monthly_report
    from src.market.overnight import fetch_overnight_signals, assess_market_tone
    from src.analysis.news_analyzer import create_digest
    from src.analysis.stock_picker import pick_watch_stocks
    print('✓ 모든 핵심 모듈 import 성공')
except ImportError as e:
    print(f'✗ Import 오류: {e}')
    sys.exit(1)
"
```

### 4. GitHub Actions 시뮬레이션
GitHub Actions에서 실행되는 명령어들이 로컬에서도 동작하는지 확인:
```bash
# Morning workflow 시뮬레이션 (텔레그램 전송 없이)
NEWS_WINDOW_MODE=strict MARKET_PROVIDER=yahoo TELEGRAM_REQUIRED=false python -m scripts.run_morning --dry-run 2>&1 | head -20

# 또는 최소한 import 체크
python -m scripts.run_morning --help 2>&1 || python -c "from scripts.run_morning import main; print('✓ run_morning 스크립트 로드 성공')"
```

### 5. 자동 검증 스크립트 실행 (권장)
커밋 전에 다음 명령어를 실행하여 모든 검증을 한 번에 수행:
```bash
# 통합 검증 스크립트 실행
python scripts/validate_before_commit.py
```

이 스크립트는 다음을 자동으로 검증합니다:
- Python 문법 오류 (모든 .py 파일)
- Import 오류 (주요 모듈 및 스크립트)
- 핵심 함수 import (generate_morning_report, fetch_overnight_signals 등)
- GitHub Actions 워크플로우 파일 구조
- 기본 테스트 실행 (pytest)

## 커밋 전 체크리스트

커밋 전에 다음을 확인하세요:

- [ ] Python 문법 오류 없음 (`python -m py_compile` 통과)
- [ ] Import 오류 없음 (모든 스크립트 import 가능)
- [ ] 핵심 모듈 정상 로드 (src/**/*.py import 성공)
- [ ] 기본 테스트 통과 (`pytest tests/ -q`)
- [ ] GitHub Actions 워크플로우 파일 문법 오류 없음 (`.github/workflows/*.yml)

## 자동 검증 권장 (가장 간단한 방법)

커밋 푸시 전에 다음 명령어 하나만 실행하면 됩니다:

```bash
# 통합 검증 스크립트 실행 (모든 검증을 한 번에 수행)
python scripts/validate_before_commit.py
```

이 스크립트가 모든 검증을 수행하고 결과를 요약해줍니다.

## 주의사항

1. **IndentationError 방지**: Python 파일 수정 시 들여쓰기를 정확히 확인하세요.
2. **Import 순환 참조**: 모듈 간 순환 import가 없는지 확인하세요.
3. **환경변수 의존성**: GitHub Actions에서 사용하는 환경변수가 모두 설정되어 있는지 확인하세요.
4. **경로 문제**: `sys.path` 설정이 올바른지 확인하세요 (특히 scripts/에서 실행 시).

## Git 규칙

- 회사 공식 레포 (bitbucket.org/coinplugin/, github.com/metadium/)에는 push 금지
- 개인 GitHub 계정 (github.com/jsong1230/)에만 push 가능
- Study 브랜치는 로컬에서만 관리, push하지 않음

